- unless @discerner_search.blank?
  = render 'discerner/shared/error_messages', :object => @discerner_search

  #discerner_search_form
    = form_for @discerner_search, :html => { :id => 'search' } do |f|
      = f.hidden_field :username, :value => discerner_user.username unless discerner_user.blank?
      - @discernerSearchParametersTemplate = generate_nested_attributes_template(f, :search_parameters, 'search_parameter')

      = render :partial => 'form_header', :locals => { :f => f }
      - unless enable_combined_searches?.blank?
        = render :partial => 'form_combined_searches', :locals => { :f => f }
      = render :partial => 'form_search_parameters', :locals => { :f => f }

      .discerner-buttons
        - if @discerner_search.disabled?
          = submit_tag 'Update search', :class => "discerner-button discerner-button-positive"
        - else
          = submit_tag 'Search', :class => "discerner-button discerner-button-positive"
        - if @discerner_search.persisted? && export_discerner_results? && discerner_export_link
          = discerner_export_link
        = link_to 'Clear', new_search_path, :class => "discerner-button discerner-button-negative"
  .clear

  :javascript
    $(function () {
      var yearRange = '#{DateTime.now.year - 100}:#{DateTime.now.year}',
      renameUrl = '#{@discerner_search.persisted? ? rename_search_path(@discerner_search) : ""}';
      new Discerner.Search.UI({
        yearRange: yearRange,
        renameUrl: renameUrl
      })
    });